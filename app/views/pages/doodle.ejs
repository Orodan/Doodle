<!doctype html>
<html lang="fr">
<head>
    <% include ../partials/head %>
</head>
<body class="container">

<!-- NAVIGATION -->
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="/profile">Doodle</a>
        </div>
        <div>
            <ul class="nav navbar-nav">
                <% if ( user_statut != 'unregistred' ) { %>
                    <% if ( user_statut == 'admin' ) { %>
                        <li><a href='<%= doodle.id %>/add-user'><%= __('Add user') %></a></li>
                        <li><a href='<%= doodle.id %>/add-schedule'><%= __('Add schedule') %></a></li>
                    <% } %>
                    <li><a href='<%= doodle.id %>/add-vote'><%= __('Add vote') %></a></li>
                <% } else { %>
                    <li><a href='<%= doodle.id %>/add-public-user'><%= __('Add temporary user') %></a></li>
                <% } %>
                <% if ( user_statut == 'admin' ) { %>
                    <li><a href='<%= doodle.id %>/remove-user'><%= __('Remove user') %></a></li>
                    <li><a href='<%= doodle.id %>/delete-schedule'><%= __('Remove schedule') %></a></li>
                <% } %>
            </ul>
        </div>
    </div>
</nav>

<!-- Breadcrumb -->
<ol class="breadcrumb">
    <li><a href="/home">Home</a></li>
    <li class="active">Doodle</li>
</ol>

<% if (message.length > 0) { %>
<div class="col-md-6 col-md-offset-3 alert alert-info" role="alert">
    <%= __('' + message + ''); %>
</div>
<% } %>


<!-- DOODLE DATA -->
<% if (doodle) { %>
    <main class="col-md-12 horiz-scroll">
        <table cellpadding="0" cellspacing="0" class="poll" style="min-width: 800px;">
            <thead>
                <!-- MONTH AND YEAR -->
                <tr class="header date month">
                    <th class="nonHeader"></th>
                    <% var alreadyCompared = []; %>
                    <% for (var key in doodle.schedules) { %>
                        <% if (alreadyCompared.indexOf(doodle.schedules[key].begin_date) < 0 ) { %>
                            <% var nbSameMonthYear = 0; %>
                            <% for (var key2 in doodle.schedules) { %>
                                <% if ( (doodle.schedules[key].begin_date.isSame(doodle.schedules[key2].begin_date, 'year')) &&
                                        (doodle.schedules[key].begin_date.isSame(doodle.schedules[key2].begin_date, 'month')) ) { %>
                                        <% nbSameMonthYear++; %>
                                        <% alreadyCompared.push(doodle.schedules[key2].begin_date);%>
                                <% } %>
                            <% } %>
                            <th colspan="<%= (nbSameMonthYear); %>"><%= doodle.schedules[key].begin_date.format('MMM YYYY'); %></th>
                        <% } %>
                    <% } %>
                </tr>

                <!-- DAY -->
                <tr class="header date day">
                    <th class="nonHeader"></th>
                    <% for (var key in doodle.schedules) { %>
                        <% if (doodle.schedules[key].begin_date.isSame(doodle.schedules[key].end_date, 'day')) { %>
                            <th colspan="1"><%= doodle.schedules[key].begin_date.format('ddd D'); %></th>
                        <% } else { %>
                            <th colspan="1"><%= doodle.schedules[key].begin_date.format('ddd D'); %> - <%= doodle.schedules[key].end_date.format('ddd D'); %></th>
                        <% } %>
                    <% } %>
                </tr>

                <!-- TIME -->
                <tr class="header time">
                    <th class="nonHeader"></th>
                    <% for (var key in doodle.schedules) { %>
                        <th colspan="1">
                            <%= doodle.schedules[key].begin_date.format('LT'); %>
                            <br />
                            -
                            <br />
                            <%= doodle.schedules[key].end_date.format('LT'); %>
                        </th>
                    <% } %>
                </tr>
            </thead>

            <tbody>
                <% for (var key in doodle.users) { %>
                    <% console.log(doodle.users[key]); %>
                    <tr class="participant">
                        <td class="pname"><%= doodle.users[key].first_name %> <%= doodle.users[key].last_name %></td>
                        <% for (var key2 in doodle.users[key].votes) { %>
                            <% if (doodle.users[key].votes[key2].vote === 0) { %>
                                <td class="partTableCell u"><i class="fa fa-question fa-lg"></i></td>
                            <% } else if (doodle.users[key].votes[key2].vote === 1) { %>
                                <td class="partTableCell y"><i class="fa fa-check-square-o fa-lg"></i></td>
                            <% } else if (doodle.users[key].votes[key2].vote === -1) { %>
                                <td class="partTableCell n"><i class="fa fa-times fa-lg"></i></td>
                            <% } %>
                        <% } %>
                    </tr>
                <% } %>
            </tbody>

        </table>
    </main>
<% } %>

<br>
<br>
<br>
<br>
<br>


<!-- PARTICIPATION REQUESTS -->
<% if ( typeof doodle.participation_requests != 'undefined' && doodle.participation_requests.length > 0 ) { %>
    <div class="col-md-6 col-md-offset-3 alert alert-info" role="alert">
            <ul>
            <% for ( var key in doodle.participation_requests ) { %>
                <li>
                    <%= doodle.participation_requests[key].first_name + ' ' + doodle.participation_requests[key].last_name + ' has been invited to participate' %>
                </li>
            <% } %>
            </ul>
    </div>
<% } %>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/moment.js"></script>
<script type="text/javascript" src="/js/script.js"></script>
</body>
</html>