<!-- views/pages/home.ejs -->
<!doctype html>
<html>
<head>
    <% include ../partials/head %>
</head>
<body class="container">

<!-- Header -->
<% include ../partials/header %>

<!-- Content -->
<main>
    <div class="row">
        <!-- NOTIFICATION MESSAGE -->
        <% if (notifications && notifications.length > 0) { %>
            <div id="notifications-box">
                <div class="col-md-6" id="notifications">
                    <% var notifications_not_read = 0; %> 
                    <% for ( var key in notifications ) { %>
                        <% if ( notifications[key].is_read === false ) { %>
                            <% notifications_not_read++; %>
                        <% } %>
                    <% } %>

                    <!-- Different icon according if there is a notification to read or not -->
                    <% if (notifications_not_read > 0) { %>
                        <a href="#" id="notifications-button"><span class="fa fa-envelope fa-2x"></span><span class="badge"><%= notifications_not_read %></span></a><br/>
                    <% } else { %>
                        <a href="#" id="notifications-button"><span class="fa fa-envelope-o fa-2x"></span></a><br/>
                    <% } %>

                    <!-- notifications -->
                    <div class="well hidden notifications-content" id="notifications-content">
                    <% for (var key in notifications ) { %>
                        <div class="notification" data="<%= notifications[key].notification_id %>">
                            <% if (notifications[key].is_read === false) { %>
                                <span class="badge">New</span><br/>
                            <% } %>

                            <%= notifications[key].user.first_name + ' ' + notifications[key].user.last_name %>
                            <%= __('has modify his/her vote about the following schedule : '); %>
                            <%= notifications[key].schedule.begin_date + ' to ' + notifications[key].schedule.end_date %>
                            <%= __('on the doodle '); %>
                            <%= notifications[key].doodle.name; %>
                        </div>
                        <hr/> 
                    <% } %>
                    </div>
                </div>
            </div>
        <% } %>
    </div>

    <div class="row">
        <!-- ALERT MESSAGE -->
        <% if (message && message.length > 0) { %>
            <div class="col-md-6 col-md-offset-3 alert alert-info" role="alert">
                <%= __('' + message + '') %>
            </div>
        <% } %>

        <!-- DOODLES INFORMATIONS -->
        <div class="col-md-8">
            <div class="well">
                <h3><span class="fa fa-archive"></span> <%= __('My doodles') %></h3>
                <hr>
                <% if (doodles) { %>
                    <ul>
                        <% for(var key in doodles) { %>
                            <li>
                                <strong><%= doodles[key].name %></strong><br>
                                <%= doodles[key].description %><br>
                                <a href='/doodle/<%= doodles[key].id %>'><%= __('Access doodle') %></a><br>
                                <% if (doodles[key].user_statut == 'admin') { %>
                                    <a href='/doodle/delete/<%= doodles[key].id %>'><%= __('Remove doodle') %></a>
                                <% } %>
                            </li>
                            <br>
                        <% } %>
                    </ul>
                <% } %>
                <br>
                <a href="/new-doodle" class="btn btn-primary btn-sm"><%= __('Create doodle') %></a>
            </div>
        </div>

        <!-- PARTICIPATION REQUESTS -->
        <div class="col-md-4">
            <div class="well">
                <h3><span class="fa fa-question"></span> <%= __('Participation requests') %></h3>
                <% if ( participation_requests != null && participation_requests.length > 0 ) { %>
                    <ul>
                        <% for (var key in participation_requests ) { %>
                            <li>
                                <strong><%= participation_requests[key].name %></strong><br/>
                                <%= participation_requests[key].description %><br/>

                                <a href='/doodle/<%= participation_requests[key].id %>/participate'><%= __('Participate') %></a><br/>


                                <a href='/doodle/<%= participation_requests[key].id %>/decline'><%= __('Decline') %></a>
                            </li>
                        <% } %>
                    </ul>
                <% } else { %>
                    <p><%= __('You have no request to participate to a doodle') %></p>
                <% } %>
            </div>
        </div>

    </div>
</main>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<!-- <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
<script type="text/javascript" src="/js/script.js"></script>

<footer class="footer" style="width: inherit;">
    <% include ../partials/footer %>
</footer>

</body>
</html>